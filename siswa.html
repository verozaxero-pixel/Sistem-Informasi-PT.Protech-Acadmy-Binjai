<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Data Siswa - PT Protech Academy</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f4f6f8; /* background sama seperti sidebar example */
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    nav.sidebar {
      width: 220px;
      background: #222d44;
      color: white;
      min-height: 100vh;
      padding: 20px 10px;
      box-sizing: border-box;
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
    }
    nav.sidebar .logo-container {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
      padding-left: 10px;
    }
    nav.sidebar .logo-container img {
      width: 40px;
      height: 40px;
      object-fit: contain;
    }
    nav.sidebar h2 {
      margin: 0;
      font-weight: bold;
      font-size: 20px;
    }
    nav.sidebar a {
      display: block;
      padding: 12px 15px;
      color: #ddd;
      text-decoration: none;
      margin-bottom: 8px;
      border-radius: 5px;
    }
    nav.sidebar a.active,
    nav.sidebar a:hover {
      background: #5c77f2;
      color: white;
    }
    main.content {
      margin-left: 220px;
      padding: 25px 40px;
      box-sizing: border-box;
      flex: 1 0 auto;
      overflow-x: auto;
      padding-bottom: 80px; /* space for footer */
      background: #f4f6f8; /* buat serasi dengan body */
    }
    h1 {
      margin-top: 0;
      color: #333;
    }
    .toolbar {
      margin-bottom: 15px;
    }
    .toolbar input[type="text"] {
      padding: 7px 10px;
      width: 280px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 4px;
      margin-right: 10px;
    }
    .toolbar button {
      padding: 7px 14px;
      margin-right: 5px;
      background: #5c77f2;
      border: none;
      border-radius: 4px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .toolbar button:hover {
      background: #405ac9;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 0 6px rgb(0 0 0 / 0.1);
    }
    table th,
    table td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: left;
    }
    table th {
      background: #f0f0f0;
    }
    .form-box {
      margin-bottom: 25px;
      background: white;
      padding: 15px 20px;
      box-shadow: 0 0 6px rgb(0 0 0 / 0.1);
      border-radius: 6px;
      max-width: 600px;
    }
    .form-box input {
      width: calc(33% - 10px);
      padding: 8px 10px;
      margin-right: 15px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
    }
    .form-box input:last-child {
      margin-right: 0;
    }
    .form-box button {
      padding: 8px 18px;
      background: #28a745;
      border: none;
      color: white;
      font-weight: 600;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .form-box button:hover {
      background: #1e7e34;
    }
    footer {
      background: #222d44;
      color: white;
      padding: 15px 40px;
      font-size: 14px;
      text-align: center;
      position: fixed;
      bottom: 0;
      left: 220px;
      right: 0;
      box-sizing: border-box;
      flex-shrink: 0;
      z-index: 1000;
    }
  </style>
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>

<nav class="sidebar">
  <div class="logo-container">
    <img src="logo.jpg" alt="Logo Protech" />
    <h2>PT Protech Academy</h2>
  </div>
  <a href="dashboard.html">üè† Dashboard</a>
  <a href="instruktur.html">üë®‚Äçüè´ Data Instruktur</a>
  <a href="siswa.html" class="active">üë®‚Äçüéì Data Siswa</a>
  <a href="login.html">üîê Logout</a>
</nav>

<main class="content">
  <h1>Data Siswa</h1>

  <div class="form-box" id="formSiswa">
    <input type="text" id="nama" placeholder="Nama Siswa" required />
    <input type="text" id="kelas" placeholder="Kelas" required />
    <input type="email" id="email" placeholder="Email" required />
    <button id="btnTambah">Tambah</button>
  </div>

  <div class="toolbar">
    <input type="text" id="searchInput" placeholder="Cari siswa..." />
    <button id="btnPrint">Cetak</button>
    <button id="btnExcel">Ekspor Excel</button>
    <button id="btnPDF">Ekspor PDF</button>
    <input type="file" id="importExcel" accept=".xlsx" style="margin-left: 15px;" />
  </div>

  <table id="tabelSiswa">
    <thead>
      <tr>
        <th>No</th>
        <th>Nama</th>
        <th>Kelas</th>
        <th>Email</th>
        <th>Aksi</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</main>

<footer>
  PT Protech Academy Semua Pihak Di lindungi &copy; 2025 
</footer>

<script>
  let dataSiswa = JSON.parse(localStorage.getItem('siswa')) || [];
  const tabelBody = document.querySelector('#tabelSiswa tbody');
  const inputNama = document.getElementById('nama');
  const inputKelas = document.getElementById('kelas');
  const inputEmail = document.getElementById('email');
  const btnTambah = document.getElementById('btnTambah');
  const searchInput = document.getElementById('searchInput');

  let editIndex = -1;

  function validateEmail(email) {
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return re.test(email.toLowerCase());
  }

  function renderTabel() {
    const keyword = searchInput.value.toLowerCase();
    tabelBody.innerHTML = '';
    let no = 1;
    dataSiswa.forEach((item, index) => {
      if (
        item.nama.toLowerCase().includes(keyword) ||
        item.kelas.toLowerCase().includes(keyword) ||
        item.email.toLowerCase().includes(keyword)
      ) {
        const row = document.createElement('tr');

        if (editIndex === index) {
          row.innerHTML = `
            <td>${no++}</td>
            <td><input type="text" id="editNama" value="${item.nama}" /></td>
            <td><input type="text" id="editKelas" value="${item.kelas}" /></td>
            <td><input type="email" id="editEmail" value="${item.email}" /></td>
            <td>
              <button id="btnSave">Save</button>
              <button id="btnCancel">Cancel</button>
            </td>
          `;
          row.querySelector('#btnSave').addEventListener('click', () => {
            const newNama = row.querySelector('#editNama').value.trim();
            const newKelas = row.querySelector('#editKelas').value.trim();
            const newEmail = row.querySelector('#editEmail').value.trim();

            if (!newNama || !newKelas || !newEmail) {
              alert('Semua field harus diisi!');
              return;
            }
            if (!validateEmail(newEmail)) {
              alert('Format email tidak valid!');
              return;
            }

            dataSiswa[index] = { nama: newNama, kelas: newKelas, email: newEmail };
            localStorage.setItem('siswa', JSON.stringify(dataSiswa));
            editIndex = -1;
            renderTabel();
          });

          row.querySelector('#btnCancel').addEventListener('click', () => {
            editIndex = -1;
            renderTabel();
          });
        } else {
          row.innerHTML = `
            <td>${no++}</td>
            <td>${item.nama}</td>
            <td>${item.kelas}</td>
            <td>${item.email}</td>
            <td>
              <button class="btnEdit">Edit</button>
              <button class="btnHapus">Hapus</button>
            </td>
          `;
          row.querySelector('.btnEdit').addEventListener('click', () => {
            editIndex = index;
            renderTabel();
          });
          row.querySelector('.btnHapus').addEventListener('click', () => {
            if (confirm('Yakin ingin menghapus data ini?')) {
              dataSiswa.splice(index, 1);
              localStorage.setItem('siswa', JSON.stringify(dataSiswa));
              if (editIndex === index) editIndex = -1;
              renderTabel();
            }
          });
        }
        tabelBody.appendChild(row);
      }
    });
  }

  btnTambah.addEventListener('click', () => {
    const nama = inputNama.value.trim();
    const kelas = inputKelas.value.trim();
    const email = inputEmail.value.trim();

    if (!nama || !kelas || !email) {
      alert('Semua field wajib diisi!');
      return;
    }
    if (!validateEmail(email)) {
      alert('Format email tidak valid!');
      return;
    }

    dataSiswa.push({ nama, kelas, email });
    localStorage.setItem('siswa', JSON.stringify(dataSiswa));
    renderTabel();

    inputNama.value = '';
    inputKelas.value = '';
    inputEmail.value = '';
  });

  searchInput.addEventListener('input', renderTabel);

  document.getElementById('btnPrint').addEventListener('click', () => {
    const printWindow = window.open('', '', 'width=800,height=600');
    printWindow.document.write('<html><head><title>Cetak Data Siswa</title></head><body>');
    printWindow.document.write('<h1>Data Siswa</h1>');
    printWindow.document.write(document.getElementById('tabelSiswa').outerHTML);
    printWindow.document.write('</body></html>');
    printWindow.document.close();
    printWindow.print();
  });

  document.getElementById('btnExcel').addEventListener('click', () => {
    const ws_data = [
      ['No', 'Nama', 'Kelas', 'Email'],
      ...dataSiswa.map((item, i) => [i + 1, item.nama, item.kelas, item.email])
    ];
    const wb = XLSX.utils.book_new();
    const ws = XLSX.utils.aoa_to_sheet(ws_data);
    XLSX.utils.book_append_sheet(wb, ws, 'Siswa');
    XLSX.writeFile(wb, 'Data_Siswa_Protech.xlsx');
  });

  document.getElementById('btnPDF').addEventListener('click', () => {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.text('Data Siswa PT Protech Academy', 10, 10);

    let startY = 20;
    dataSiswa.forEach((item, i) => {
      doc.text(`${i + 1}. ${item.nama} - ${item.kelas} - ${item.email}`, 10, startY);
      startY += 10;
    });
    doc.save('Data_Siswa_Protech.pdf');
  });

  document.getElementById('importExcel').addEventListener('change', function (e) {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function (e) {
      const data = new Uint8Array(e.target.result);
      const workbook = XLSX.read(data, { type: 'array' });
      const sheetName = workbook.SheetNames[0];
      const worksheet = workbook.Sheets[sheetName];
      const importedData = XLSX.utils.sheet_to_json(worksheet);

      importedData.forEach((row) => {
        if (row.Nama && row.Kelas && row.Email) {
          dataSiswa.push({
            nama: row.Nama,
            kelas: row.Kelas,
            email: row.Email
          });
        }
      });

      localStorage.setItem('siswa', JSON.stringify(dataSiswa));
      renderTabel();
      alert('Data berhasil diimpor!');
    };
    reader.readAsArrayBuffer(file);
  });

  renderTabel();
</script>

</body>
</html>
